@{
    Layout = "~/_Layout.cshtml";
    Page.Title = string.Format("Razor - {0}", "CRUD - Update/Discontinue/Delete with Validation");

    var pid = Request.QueryString["pid"];
    if (pid.IsEmpty())
    {
        Response.Redirect("Exercise04a.cshtml");
    }
    var title = Request.Form["Title"];
    var artist = Request.Form["Artist"];
    var year = Request.Form["Year"];
    var label = Request.Form["Label"];
    var message = "";

    //these are validator controls execute on the server side

    // ---------------------   Validations ------------------------------

    Validation.Add("Title",
         Validator.Required("Title is required"),
         Validator.StringLength(160, 1, "Title is limited to 160 characters"));

    Validation.Add("ArtistId",
         Validator.Range(1, 275));

    Validation.Add("ReleaseYear",
        Validator.Required("Year is out of range, 1950 to today"),
         Validator.StringLength(DateTime.Today.Year));

    Validation.Add("ReleaseLabel",
        Validator.StringLength(50, 1, "Label is limited to 50 characters"));


    // ---------------------   database selects ------------------------------

    var db = Database.Open("CHINOOK");

    var titleStatement = "SELECT ArtistID, Title "
                        + "FROM Albums "
                        + "ORDER BY Title";
    var querytitle = db.Query(titleStatement);

    var artistStatement = "SELECT ArtistID, Name "
                        + "FROM Artists "
                        + "ORDER BY Name";
    var queryartist = db.Query(artistStatement);

    var queryStatement = "SELECT AlbumID, Title, ArtistId, ReleaseYear, ReleaseLabel"
                        + "FROM Albums "
                        + "WHERE AlbumID = @0";
    var queryProducts = db.QuerySingle(queryStatement, pid);
    if (queryProducts == null)
    {
        message = "Product NOT found";
    }
}

@section head{
    @*<link href="~/Content/MyCssCopy.css" rel="stylesheet" />*@
}

@section banner{
    <h1>@Page.Title</h1>
}

